# 第三章 正则表达式括号的作用

> - 分组和分支结构
> - 捕获分组
> - 反向引用
> - 非捕获分组
> - 相关案例

## 1. 分组和分支结构

1.1 分组

```bash
let reg = /(ab)+/g;
let str = 'abab abbbb';
str.match(reg);
// ["abab", "ab"]
```

1.2 分支结构

```bash

var regex = /^I love (JavaScript|Regular Expression)$/;
console.log( regex.test("I love JavaScript") ); // true
console.log( regex.test("I love Regular Expression") ); // true
```

## 2. 引用分组

2.1 提取数据

提取出年、月、日; yyyy-mm-dd

```bash
let reg = /(\d{4})-(\d{2})-(\d{2})/;
let str = '2020-06-02';
str.match(reg);
// ["2020-06-02", "2020", "06", "02", index: 0, input: "2020-06-02", groups: undefined]

reg.exec(str);
// ["2020-06-02", "2020", "06", "02", index: 0, input: "2020-06-02", groups: undefined]
```

2.2 替换

yyyy-mm-dd => mm/dd/yyyy

```bash
let reg = /(\d{4})-(\d{2})-(\d{2})/;
let str = '2020-06-02';
str.replace(reg, '$2/$3/$1');
// "06/02/2020"
```

$1、$2、\$3 指代相应的分组

```bash
string.replace(regex, function() {
	return RegExp.$2 + "/" + RegExp.$3 + "/" + RegExp.$1;
});

```

## 3. 反向引用

除了使用相应 API 来引用分组，也可以在正则本身里引用分组。但只能引用之前出现的分组，即反向引用。

匹配如下三种格式：

```bash
2016-06-12

2016/06/12

2016.06.12
```

```bash
// \1，表示的引用之前的那个分组(-|\/|\.)。不管它匹配到什么（比如-），\1都匹配那个同样的具体某个字符
let reg = /\d{4}(-|\/|\.)\d{2}\1\d{2}/;
reg.test('2020-06-02'); // true
reg.test('2020/06/02'); // true
reg.test('2020.06.02'); // true
reg.test('2020-06/02'); // false
```

3.1 括号嵌套

以左括号（开括号）为准

```bash
let reg = /^((\d)(\d(\d)))\1\2\3\4$/;
let str =  "1231231233";
reg.test(str);
str.match(reg);
//  ["1231231233", "123", "1", "23", "3", index: 0, input: "1231231233", groups: undefined]

console.log(RegExp.$1); // 123
console.log(RegExp.$2); // 1
console.log(RegExp.$3); // 23
console.log(RegExp.$4); // 3
```

3.2 引用不存在的分组

匹配反向引用的字符本身

```bash
let regex = /\1\2\3\4\5\6\7\8\9/;
console.log( regex.test("\1\2\3\4\5\6\7\8\9") ); // true
console.log( "\1\2\3\4\5\6\7\8\9".split("") );
//  ["", "", "", "", "", "", "", "8", "9"]
```

## 4. 非捕获分组 (?:p)

如果只想要括号最原始的功能，但不会引用它，即，既不在 API 里引用，也不在正则里反向引用。此时可以使用非捕获分组(?:p)

```bash
let reg = /(?:ab)+/g;
let str = 'ababab aba ab';
str.match(reg);
// ["ababab", "ab", "ab"]
```

## 5. 相关案例

5.1 字符串 trim 方法模拟

```bash
function trim(str) {
  return str.replace(/^\s+|\s+$/g,'');
  // return str.replace(/^\s*(.*?)\s*$/g, "$1")
}
trim('  12 3  ');
```

5.2 将每个单词的首字母转换为大写

```bash
function titleize(str) {
  return str.toLowerCase().replace(/(?:^|\s)\w/g, function(item) {
		return item.toUpperCase();
	});
}
titleize('hello world');
```

5.3 驼峰化

```bash
function camelize(str) {
	return str.replace(/[-_\s]+(.)?/g, function(match, c) {
		return c ? c.toUpperCase() : '';
	});
}
console.log( camelize('-moz-transform') );
```

5.4 匹配成对标签

匹配一个开标签，可以使用正则<[^>]+>，

匹配一个闭标签，可以使用<\/[^>]+>，

要求匹配：

```bash
<title>regular expression</title>

<p>laoyao bye bye</p>
```

```bash
var regex = /<([^>]+)>[\d\D]*<\/\1>/;
var string1 = "<title>regular expression</title>";
var string2 = "<p>laoyao bye bye</p>";
var string3 = "<title>wrong!</p>";
console.log( regex.test(string1) ); // true
console.log( regex.test(string2) ); // true
console.log( regex.test(string3) ); // false
```
